<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Поминальная служба - Тикун Ха-Шем</title>
  <meta name="description" content="Поминальная служба на русском языке. Чтение псалмов и молитв за упокой души.">
  <meta name="keywords" content="поминальная служба, изкор, псалмы, молитвы, иудаизм">
  <meta name="author" content="Тикун Ха-Шем">
  <meta property="og:title" content="Поминальная служба - Тикун Ха-Шем">
  <meta property="og:description" content="Поминальная служба на русском языке">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://tikun-hashem.com/memorial.html">
  <link rel="canonical" href="https://tikun-hashem.com/memorial.html">
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#4361ee">
  <link rel="stylesheet" href="styles/css/styles.css">
  <link rel="stylesheet" href="styles/css/accessibility.css">
  <link rel="stylesheet" href="styles/css/calendar.css">
  <link rel="stylesheet" href="src/styles/main.css">
  <link rel="stylesheet" href="src/styles/dark-mode.css">
  <script src="js/i18n.js" defer></script>
  <script src="js/main.js" defer></script>
  <script src="js/floating-letters.js" defer></script>
  <script src="js/calendar.js" defer></script>
  <script src="js/corrector.js"></script>
  <style>
    /* בסיס */
    @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=PT+Serif:wght@400;700&family=Frank+Ruhl+Libre:wght@400;700&display=swap');
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    :root {
      --primary: #4361ee;
      --primary-light: #4895ef;
      --background: #f8f9fa;
      --card: #ffffff;
      --text: #212529;
      --text-light: #6c757d;
      --border: #dee2e6;
      --shadow-sm: 0 2px 8px rgba(0,0,0,0.05);
      --radius: 16px;
      --header-height: 60px;
      --bottom-nav-height: 65px;
      --content-padding: 16px;
      --font-he: 'Noto Sans Hebrew', sans-serif;
      --font-ru: 'PT Serif', serif;
    }
    
    body {
      font-family: var(--font-he);
      background-color: var(--background);
      color: var(--text);
      line-height: 1.5;
      font-size: 16px;
      padding-bottom: var(--bottom-nav-height);
      padding-top: var(--header-height);
    }
    
    [data-lang="ru"] body { font-family: var(--font-ru); }
    
    /* כותרת */
    .header {
      position: fixed;
      top: 0;
      right: 0;
      left: 0;
      height: var(--header-height);
      background-color: var(--card);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 var(--content-padding);
      box-shadow: var(--shadow-sm);
      z-index: 100;
    }
    
    .header-title {
      font-weight: 700;
      font-size: 18px;
    }
    
    .back-button {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--text);
      font-size: 18px;
      background-color: transparent;
      border: none;
      text-decoration: none;
    }
    
    /* תוכן */
    .container {
      padding: var(--content-padding);
      max-width: 800px;
      margin: 0 auto;
    }
    
    /* בורר שפה */
    .language-bar {
      display: flex;
      background-color: var(--card);
      border-radius: var(--radius);
      overflow: hidden;
      margin-bottom: 20px;
      box-shadow: var(--shadow-sm);
    }
    
    .language-option {
      flex: 1;
      padding: 12px;
      text-align: center;
      cursor: pointer;
      font-weight: 500;
      transition: background-color 0.2s;
    }
    
    .language-option.active {
      background-color: var(--primary);
      color: white;
    }
    
    /* הכנסת שם הנפטר */
    .memorial-form {
      background-color: var(--card);
      border-radius: var(--radius);
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: var(--shadow-sm);
    }
    
    .form-title {
      font-size: 20px;
      font-weight: 700;
      margin-bottom: 16px;
      text-align: center;
    }
    
    .form-desc {
      margin-bottom: 16px;
      text-align: center;
      color: var(--text-light);
      font-size: 14px;
    }
    
    .form-group {
      margin-bottom: 16px;
    }
    
    .form-label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
    }
    
    .form-control {
      width: 100%;
      padding: 12px;
      border: 1px solid var(--border);
      border-radius: 6px;
      font-size: 16px;
      direction: rtl;
    }
    
    .button-primary {
      display: block;
      width: 100%;
      padding: 12px;
      background-color: var(--primary);
      color: white;
      border: none;
      border-radius: var(--radius);
      font-weight: 600;
      font-size: 16px;
      cursor: pointer;
    }
    
    /* כרטיסיות תפילות */
    .prayer-tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 16px;
      overflow-x: auto;
      padding-bottom: 8px;
    }
    
    .prayer-tab {
      padding: 12px 16px;
      background-color: var(--background);
      border-radius: var(--radius);
      font-weight: 500;
      white-space: nowrap;
      cursor: pointer;
      transition: background-color 0.2s, color 0.2s;
    }
    
    .prayer-tab.active {
      background-color: var(--primary);
      color: white;
    }
    
    /* תוכן התפילה */
    .prayer-content {
      background-color: var(--card);
      border-radius: var(--radius);
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: var(--shadow-sm);
    }
    
    .prayer-title {
      font-size: 20px;
      font-weight: 700;
      margin-bottom: 16px;
      text-align: center;
    }
    
    .prayer-subtitle {
      font-size: 16px;
      color: var(--text-light);
      margin-bottom: 24px;
      text-align: center;
      font-style: italic;
    }
    
    .prayer-instruction {
      padding: 12px;
      background-color: rgba(67, 97, 238, 0.1);
      border-radius: 6px;
      margin-bottom: 16px;
      font-size: 14px;
    }
    
    .prayer-text {
      margin-bottom: 24px;
      line-height: 1.8;
    }
    
    .prayer-text p {
      margin-bottom: 16px;
    }
    
    .prayer-section {
      margin-bottom: 16px;
    }
    
    .prayer-section-title {
      font-weight: 700;
      margin-bottom: 12px;
      font-size: 18px;
    }
    
    /* כלי קריאה */
    .reading-tools {
      background-color: var(--card);
      border-radius: var(--radius);
      padding: 16px;
      margin-bottom: 20px;
      box-shadow: var(--shadow-sm);
    }
    
    .tools-title {
      font-weight: 600;
      font-size: 16px;
      margin-bottom: 16px;
    }
    
    .tools-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 8px;
      margin-bottom: 12px;
    }
    
    @media (min-width: 480px) {
      .tools-grid {
        grid-template-columns: repeat(4, 1fr);
      }
    }
    
    .tool-button {
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: var(--background);
      border: none;
      border-radius: 6px;
      font-weight: 500;
      cursor: pointer;
      transition: background-color 0.2s;
    }
    
    .tool-button:hover, .tool-button.active {
      background-color: var(--primary-light);
      color: white;
    }
    
    .font-size-controls {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
    }
    
    .font-size-button {
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: var(--background);
      border: none;
      border-radius: 6px;
      font-weight: bold;
      cursor: pointer;
    }
    
    .font-size-value {
      font-weight: 500;
    }
    
    /* כפתורי שיתוף */
    .share-buttons {
      display: flex;
      justify-content: center;
      gap: 16px;
      margin-top: 24px;
    }
    
    .share-button {
      padding: 10px 16px;
      border-radius: 6px;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
      border: none;
    }
    
    .button-print {
      background-color: #6c757d;
      color: white;
    }
    
    .button-share {
      background-color: #4caf50;
      color: white;
    }
    
    /* רשימת יארצייט */
    .yahrzeit-list {
      background-color: var(--card);
      border-radius: var(--radius);
      margin-bottom: 20px;
      box-shadow: var(--shadow-sm);
      overflow: hidden;
    }
    
    .yahrzeit-header {
      padding: 16px;
      background-color: rgba(67, 97, 238, 0.1);
      font-weight: 700;
      font-size: 16px;
    }
    
    .yahrzeit-item {
      padding: 16px;
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
    }
    
    .yahrzeit-item:last-child {
      border-bottom: none;
    }
    
    .yahrzeit-info {
      flex: 1;
    }
    
    .yahrzeit-name {
      font-weight: 500;
      margin-bottom: 4px;
    }
    
    .yahrzeit-date {
      font-size: 14px;
      color: var(--text-light);
    }
    
    .yahrzeit-action {
      margin-left: 12px;
    }
    
    /* ניווט תחתון */
    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      height: var(--bottom-nav-height);
      background-color: var(--card);
      display: flex;
      justify-content: space-around;
      align-items: center;
      box-shadow: 0 -2px 8px rgba(0,0,0,0.08);
      z-index: 100;
    }
    
    .bottom-nav-item {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 4px;
      color: var(--text-light);
      transition: color 0.2s;
      padding: 8px 0;
      text-decoration: none;
    }
    
    .bottom-nav-item.active {
      color: var(--primary);
    }
    
    .bottom-nav-icon {
      font-size: 22px;
    }
    
    .bottom-nav-label {
      font-size: 12px;
      font-weight: 500;
    }
    
    /* רב-לשוניות */
    [data-lang="he"] {
      font-family: 'Frank Ruhl Libre', serif;
      direction: rtl;
    }
    
    [data-lang="ru"] {
      font-family: 'PT Serif', serif;
      direction: ltr;
    }
    
    [data-lang="phonetic"] {
      font-family: 'Roboto', sans-serif;
      direction: ltr;
    }
  </style>
</head>
<body data-lang="he">
  <!-- כותרת -->
  <header class="header">
    <a href="index.html" class="back-button">←</a>
    <h1 class="header-title" data-translate="main_title">אזכרה</h1>
    <nav>
      <div class="language-bar">
        <div class="language-option active" data-lang="he" data-translate="lang_he">עברית</div>
        <div class="language-option" data-lang="ru" data-translate="lang_ru">רוסית</div>
        <div class="language-option" data-lang="phonetic" data-translate="lang_phonetic">תעתיק</div>
      </div>
    </nav>
  </header>
  
  <!-- תוכן -->
  <div class="container">
    <!-- בורר שפה -->
    <div class="language-bar">
      <div class="language-option active" data-lang="ru">Русский</div>
      <div class="language-option" data-lang="he">עברית</div>
      <div class="language-option" data-lang="phonetic">Фонетика</div>
    </div>
    
    <!-- הכנסת שם הנפטר -->
    <div class="memorial-form" role="form" aria-labelledby="memorial-title">
      <h2 class="form-title">Молитва за усопшего</h2>
      <p class="form-desc">Введите имя усопшего, чтобы включить его в текст молитвы</p>
      <div class="form-group">
        <label class="form-label" for="deceased-name">Имя усопшего (на иврите):</label>
        <input type="text" class="form-control" id="deceased-name" placeholder="שם הנפטר" aria-label="Имя усопшего" required tabindex="0">
      </div>
      <div class="form-group">
        <label class="form-label" for="mother-name">Имя матери усопшего (на иврите):</label>
        <input type="text" class="form-control" id="mother-name" placeholder="שם האם" aria-label="Имя матери" tabindex="0">
      </div>
      <button class="button-primary" id="update-prayers" aria-label="Применить" tabindex="0">Применить</button>
    </div>
    
    <!-- Add after the memorial form -->
    <div class="memorial-tools">
      <div class="memorial-tool">
        <div class="memorial-tool-icon">📅</div>
        <div class="memorial-tool-title">לוח שנה</div>
      </div>
      <div class="memorial-tool">
        <div class="memorial-tool-icon">📖</div>
        <div class="memorial-tool-title">מזמורי תהילים</div>
      </div>
      <div class="memorial-tool">
        <div class="memorial-tool-icon">🔔</div>
        <div class="memorial-tool-title">תזכורות</div>
      </div>
    </div>
    
    <!-- Calendar section -->
    <div class="calendar" style="display: none;">
      <div class="calendar-header">
        <h3 class="calendar-title">לוח שנה</h3>
        <div class="calendar-nav">
          <button class="calendar-nav-button">←</button>
          <button class="calendar-nav-button">→</button>
        </div>
      </div>
      
      <!-- Month selector -->
      <div class="calendar-month-selector">
        <select id="month-selector">
          <option value="0">ינואר</option>
          <option value="1">פברואר</option>
          <option value="2">מרץ</option>
          <option value="3">אפריל</option>
          <option value="4">מאי</option>
          <option value="5">יוני</option>
          <option value="6">יולי</option>
          <option value="7">אוגוסט</option>
          <option value="8">ספטמבר</option>
          <option value="9">אוקטובר</option>
          <option value="10">נובמבר</option>
          <option value="11">דצמבר</option>
        </select>
        <input type="number" id="year-selector" min="1900" max="2100" value="2024">
      </div>
      
      <div class="calendar-grid" id="calendar-grid">
        <!-- Calendar days will be populated by JavaScript -->
      </div>
      
      <!-- Yahrzeit list -->
      <div class="yahrzeit-list">
        <h4 class="yahrzeit-list-title">ימי זיכרון</h4>
        <div class="yahrzeit-list-content" id="yahrzeit-list">
          <!-- Yahrzeit items will be populated by JavaScript -->
        </div>
      </div>
    </div>
    
    <!-- Psalm selection section -->
    <div class="psalm-selection" style="display: none;">
      <h3 class="psalm-selection-title">בחר מזמורי תהילים</h3>
      
      <!-- Psalm categories -->
      <div class="psalm-categories">
        <button class="psalm-category active" data-category="all">כל המזמורים</button>
        <button class="psalm-category" data-category="memorial">לזכר נפטר</button>
        <button class="psalm-category" data-category="healing">לרפואה</button>
        <button class="psalm-category" data-category="protection">לשמירה</button>
        <button class="psalm-category" data-category="thanks">להודיה</button>
      </div>
      
      <!-- Search input -->
      <div class="psalm-search">
        <input type="text" class="search-input" placeholder="חיפוש מזמור..." oninput="filterPsalms(this.value)">
      </div>
      
      <div class="psalm-selection-grid" id="psalm-grid">
        <!-- Psalm options will be populated by JavaScript -->
      </div>
    </div>
    
    <!-- כלי קריאה -->
    <div class="reading-tools">
      <div class="tools-title">Инструменты чтения</div>
      <div class="tools-grid">
        <button class="tool-button" id="toggle-translation">Перевод</button>
        <button class="tool-button" id="toggle-nikud">Огласовки</button>
        <button class="tool-button" id="toggle-taamim">Знаки</button>
        <button class="tool-button" id="toggle-name-highlight">Имена</button>
      </div>
      <div class="font-size-controls">
        <button class="font-size-button" id="decrease-font">-</button>
        <span class="font-size-value">Размер текста: средний</span>
        <button class="font-size-button" id="increase-font">+</button>
      </div>
    </div>
    
    <!-- כרטיסיות תפילות -->
    <div class="prayer-tabs">
      <div class="prayer-tab active" data-tab="kaddish">Кадиш</div>
      <div class="prayer-tab" data-tab="el-male-rachamim">Эль мале рахамим</div>
      <div class="prayer-tab" data-tab="yizkor">Изкор</div>
      <div class="prayer-tab" data-tab="tehilim">Избранные Псалмы</div>
      <div class="prayer-tab" data-tab="azkara">День памяти</div>
    </div>
    
    <!-- תוכן התפילה - קדיש -->
    <div class="prayer-content" id="prayer-kaddish" data-lang="ru">
      <h2 class="prayer-title">Кадиш</h2>
      <div class="prayer-subtitle">Молитва освящения Имени Всевышнего</div>
      
      <div class="prayer-instruction">
        Эту молитву произносят в память об усопших родственниках. Текст написан на арамейском языке, который был разговорным языком евреев во времена составления молитвы.
      </div>
      
      <div class="prayer-text">
        <p><strong>Итгадаль вэиткадаш шмей раба.</strong> (Да возвеличится и освятится великое Имя Его)</p>
        <p><strong>Бэальма ди вра хирутей, вэямлих малхутей, вэяцмах пурканей викарев мэшихей.</strong> (В мире, который Он сотворил по воле Своей, и да явит Он царствование Своё при жизни вашей, и в дни ваши, и при жизни всего дома Израиля, вскоре, в ближайшее время. И скажем: амен!)</p>
        <p><strong>Бэхайехон увйомехон увхайей дэхоль бейт Исраэль, баагала увизман карив, вэимру амен.</strong></p>
        <p><strong>Йэhей шмей раба мэварах лэалам ульалмей альмая.</strong> (Да будет благословенно Его великое Имя всегда и во веки веков!)</p>
        <p><strong>Итбарах вэиштабах вэитпаар вэитромам вэитнасе вэитhадар вэиталё вэитhалаль шмей дэкудша, брих hу.</strong> (Да будет благословляемо, восхваляемо, прославляемо, возвеличиваемо, превозносимо, почитаемо, возводимо и воспеваемо Имя Святого, благословен Он)</p>
        <p><strong>Лэйла мин коль бирхата вэширата, тушбэхата вэнэхэмата, даамиран бэальма, вэимру амен.</strong> (выше всех благословений, и песнопений, восхвалений и утешений, произносимых в мире. И скажем: амен!)</p>
        <p><strong>Йеhей шлама раба мин шмая вэхаим алейну вэаль коль Исраэль, вэимру амен.</strong> (Да будет с небес обильный мир и жизнь нам и всему Израилю. И скажем: амен!)</p>
        <p><strong>Осэ шалом бимромав, hу яасэ шалом алейну вэаль коль Исраэль, вэимру амен.</strong> (Устанавливающий мир в высотах Своих, Он установит мир для нас и для всего Израиля. И скажем: амен!)</p>
      </div>
      
      <div class="share-buttons">
        <button class="share-button button-print">Печать</button>
        <button class="share-button button-share">Поделиться</button>
      </div>
    </div>
    
    <!-- תוכן התפילה - אל מלא רחמים -->
    <div class="prayer-content" id="prayer-el-male-rachamim" data-lang="ru" style="display: none;">
      <h2 class="prayer-title">Эль Мале Рахамим</h2>
      <div class="prayer-subtitle">Молитва "Бог, исполненный милосердия"</div>
      
      <div class="prayer-instruction">
        Эту молитву произносят в память об усопших во время поминальных служб и посещения могил. В ней просят Всевышнего даровать покой душе умершего.
      </div>
      
      <div class="prayer-text">
        <p><strong>Эль мале рахамим, шохен бамромим, амце менуха нехона аль канфей а-Шхина, бемаалот кдошим у-теорим, кезоар а-ракиа маз'ирим, эт нишмат (имя усопшего) бен/бат (имя матери) ше-алах/алха леоламо/леолама, бааво́р шебли недер этен цдака беад азкарат нишмато/нишмата. Беган Эден теэ менухато/менухата. Лахен бааль а-рахамим ястиреу/ястирэа бесетер кнафав леоламим, вицрор бицрор а-хаим эт нишмато/нишмата, Адонай У нахалато/нахалата, вэянуах/вэтануах бешалом аль мишкаво/мишкава. Веномар амен.</strong></p>
        <p>Бог, исполненный милосердия, обитающий в высотах! Да найдёт верный покой под сенью Божественного Присутствия – среди святых и чистых душ, сияющих, словно небесный свод, – душа (имя усопшего), сына/дочери (имя матери), отошедшего/отошедшей в вечность, ибо я, не связывая себя обетом, пожертвую на благотворительные цели в память о его/её душе. Да будет Сад Эдена местом его/её упокоения! Да укроет его/её Господин милосердия под покровом Своих крыльев на веки вечные и да сохранит в обители вечной жизни его/её душу! Господь – его/её наследственный удел, да упокоится он/она в мире на ложе своем, и скажем: амен.</p>
      </div>
      
      <div class="share-buttons">
        <button class="share-button button-print">Печать</button>
        <button class="share-button button-share">Поделиться</button>
      </div>
    </div>
    
    <!-- תוכן התפילה - יזכור -->
    <div class="prayer-content" id="prayer-yizkor" data-lang="ru" style="display: none;">
      <h2 class="prayer-title">Изкор</h2>
      <div class="prayer-subtitle">Поминальная молитва</div>
      
      <div class="prayer-instruction">
        Молитву Изкор произносят в синагоге четыре раза в год: в Йом Кипур, в Шмини Ацерет, в седьмой день Песаха и во второй день Шавуот.
      </div>
      
      <div class="prayer-text">
        <div class="prayer-section">
          <h3 class="prayer-section-title">За отца</h3>
          <p><strong>Изкор Элоим нишмат ави мори (имя отца) бен (имя его матери) шеалах леоламо, баавур шебли недер этен цдака беад азкарат нишмато. Ана тиье нафшо црура бицрор ахаим, им нишмот Авраам, Ицхак веЯаков, Сара, Ривка, Рахель веЛеа, веим шеар цадиким вецидканийот шебеГан Эден, венома́р амен.</strong></p>
          <p>Да вспомнит Бог душу моего отца и наставника (имя отца), сына (имя его матери), ушедшего в вечность, – ради того, что я, не связывая себя обетом, дам пожертвование на благотворительные цели в память о его душе. Да будет душа его завязана в узле вечной жизни вместе с душами Авраама, Ицхака и Яакова, Сары, Ривки, Рахели и Леи и других праведников и праведниц, пребывающих в Саду Эдена. И скажем: амен.</p>
        </div>
        
        <div class="prayer-section">
          <h3 class="prayer-section-title">За мать</h3>
          <p><strong>Изкор Элоим нишмат ими морати (имя матери) бат (имя ее матери) шеалха леолама, баавур шебли недер этен цдака беад азкарат нишмата. Ана тиье нафша црура бицрор ахаим, им нишмот Авраам, Ицхак веЯаков, Сара, Ривка, Рахель веЛеа, веим шеар цадиким вецидканийот шебеГан Эден, венома́р амен.</strong></p>
          <p>Да вспомнит Бог душу моей матери и наставницы (имя матери), дочери (имя ее матери), ушедшей в вечность, – ради того, что я, не связывая себя обетом, дам пожертвование на благотворительные цели в память о её душе. Да будет душа её завязана в узле вечной жизни вместе с душами Авраама, Ицхака и Яакова, Сары, Ривки, Рахели и Леи и других праведников и праведниц, пребывающих в Саду Эдена. И скажем: амен.</p>
        </div>
      </div>
      
      <div class="share-buttons">
        <button class="share-button button-print">Печать</button>
        <button class="share-button button-share">Поделиться</button>
      </div>
    </div>
    
    <!-- תוכן התפילה - פרקי תהילים נבחרים -->
    <div class="prayer-content" id="prayer-tehilim" data-lang="ru" style="display: none;">
      <h2 class="prayer-title">Избранные Псалмы</h2>
      <div class="prayer-subtitle">Псалмы, традиционно читаемые в память об усопших</div>
      
      <div class="prayer-instruction">
        Существует обычай читать определенные псалмы в память об усопших. Ниже приведены наиболее часто используемые псалмы. Можно читать их все или выбрать некоторые.
      </div>
      
      <div class="prayer-section">
        <h3 class="prayer-section-title">Псалом 16</h3>
        <div class="prayer-text">
          <p><strong>1.</strong> Храни меня, Боже, ибо я на Тебя уповаю.</p>
          <p><strong>2.</strong> Я сказал Господу: «Ты – Господь мой; блага мои Тебе не нужны».</p>
          <p><strong>3.</strong> К святым, которые на земле, и к дивным Твоим – к ним все желание мое.</p>
          <p><strong>4.</strong> Пусть умножаются скорби у тех, которые текут к богу чужому; я не возлию кровавых возлияний их и не помяну имен их устами моими.</p>
          <p><strong>5.</strong> Господь есть часть наследия моего и чаши моей. Ты держишь жребий мой.</p>
          <p><strong>6.</strong> Межи мои прошли по прекрасным местам, и наследие мое приятно для меня.</p>
          <p><strong>7.</strong> Благословлю Господа, вразумившего меня; даже и ночью учит меня внутренность моя.</p>
          <p><strong>8.</strong> Всегда видел я пред собою Господа, ибо Он одесную меня; не поколеблюсь.</p>
          <p><strong>9.</strong> Оттого возрадовалось сердце мое и возвеселился язык мой; даже и плоть моя успокоится в уповании,</p>
          <p><strong>10.</strong> ибо Ты не оставишь души моей в аде и не дашь святому Твоему увидеть тление,</p>
          <p><strong>11.</strong> Ты укажешь мне путь жизни: полнота радостей пред лицем Твоим, блаженство в деснице Твоей вовек.</p>
        </div>
      </div>
      
      <div class="prayer-section">
        <h3 class="prayer-section-title">Псалом 23</h3>
        <div class="prayer-text">
          <p><strong>1.</strong> Господь – Пастырь мой; я ни в чем не буду нуждаться:</p>
          <p><strong>2.</strong> Он покоит меня на злачных пажитях и водит меня к водам тихим,</p>
          <p><strong>3.</strong> подкрепляет душу мою, направляет меня на стези правды ради имени Своего.</p>
          <p><strong>4.</strong> Если я пойду и долиною смертной тени, не убоюсь зла, потому что Ты со мной; Твой жезл и Твой посох – они успокаивают меня.</p>
          <p><strong>5.</strong> Ты приготовил предо мною трапезу в виду врагов моих; умастил елеем голову мою; чаша моя преисполнена.</p>
          <p><strong>6.</strong> Так, благость и милость да сопровождают меня во все дни жизни моей, и я пребуду в доме Господнем многие дни.</p>
        </div>
      </div>
      
      <div class="prayer-section">
        <h3 class="prayer-section-title">Псалом 91</h3>
        <div class="prayer-text">
          <p><strong>1.</strong> Живущий под кровом Всевышнего под сенью Всемогущего покоится,</p>
          <p><strong>2.</strong> говорит Господу: «прибежище мое и защита моя, Бог мой, на Которого я уповаю!»</p>
          <p><strong>3.</strong> Он избавит тебя от сети ловца, от гибельной язвы,</p>
          <p><strong>4.</strong> перьями Своими осенит тебя, и под крыльями Его будешь безопасен; щит и ограждение – истина Его.</p>
          <p><strong>5.</strong> Не убоишься ужасов в ночи, стрелы, летящей днем,</p>
          <p><strong>6.</strong> язвы, ходящей во мраке, заразы, опустошающей в полдень.</p>
          <p><strong>7.</strong> Падут подле тебя тысяча и десять тысяч одесную тебя; но к тебе не приблизится:</p>
          <p><strong>8.</strong> только смотреть будешь очами твоими и видеть возмездие нечестивым.</p>
          <p><strong>9.</strong> Ибо ты сказал: «Господь – упование мое»; Всевышнего избрал ты прибежищем твоим;</p>
          <p><strong>10.</strong> не приключится тебе зло, и язва не приблизится к жилищу твоему;</p>
          <p><strong>11.</strong> ибо Ангелам Своим заповедает о тебе – охранять тебя на всех путях твоих:</p>
          <p><strong>12.</strong> на руках понесут тебя, да не преткнешься о камень ногою твоею;</p>
          <p><strong>13.</strong> на аспида и василиска наступишь; попирать будешь льва и дракона.</p>
          <p><strong>14.</strong> «За то, что он возлюбил Меня, избавлю его; защищу его, потому что он познал имя Мое.</p>
          <p><strong>15.</strong> Воззовет ко Мне, и услышу его; с ним Я в скорби; избавлю его и прославлю его,</p>
          <p><strong>16.</strong> долготою дней насыщу его, и явлю ему спасение Мое».</p>
        </div>
      </div>
      
      <div class="share-buttons">
        <button class="share-button button-print">Печать</button>
        <button class="share-button button-share">Поделиться</button>
      </div>
    </div>
    
    <!-- תוכן התפילה - יום האזכרה -->
    <div class="prayer-content" id="prayer-azkara" data-lang="ru" style="display: none;">
      <h2 class="prayer-title">День памяти (Азкара)</h2>
      <div class="prayer-subtitle">Обычаи и молитвы для дня годовщины смерти</div>
      
      <div class="prayer-instruction">
        В годовщину смерти (яарцайт) принято зажигать свечу, которая горит 24 часа, читать Кадиш (если есть возможность молиться с миньяном), изучать Мишну и посещать могилу.
      </div>
      
      <div class="prayer-text">
        <div class="prayer-section">
          <h3 class="prayer-section-title">Перед посещением могилы</h3>
          <p>Перед посещением могилы вымойте руки и произнесите:</p>
          <p><strong>Да будет воля Твоя, Господь, Бог мой и Бог отцов моих, сопровождать меня в мире и направлять мои шаги в мире, и вернуть меня в мире, и спасти меня от всякого врага и засады в пути. И пошли благословение делам рук моих, и даруй мне благодать, добро и милость в Твоих глазах и в глазах всех, кто видит меня, и внемли голосу моих молитв, ибо Ты внимаешь молитве всех уст. Благословен Ты, Господь, внимающий молитве!</strong></p>
        </div>
        
        <div class="prayer-section">
          <h3 class="prayer-section-title">На кладбище</h3>
          <p>При входе на кладбище произносят:</p>
          <p><strong>Благословен Ты, Господь, Бог наш, Царь вселенной, Который создал вас по закону, питал вас по закону, содержал вас по закону, собрал вас по закону, и в будущем воскресит вас по закону. Благословен Ты, Господь, воскрешающий мертвых.</strong></p>
          <p>У могилы читают соответствующие псалмы (16, 23, 91, 103) и произносят молитву "Эль мале рахамим".</p>
        </div>
      </div>
      
      <div class="share-buttons">
        <button class="share-button button-print">Печать</button>
        <button class="share-button button-share">Поделиться</button>
      </div>
    </div>
    
    <!-- רשימת יארצייט -->
    <div class="yahrzeit-list">
      <div class="yahrzeit-header">Список годовщин (Яарцайт)</div>
      
      <div class="yahrzeit-item">
        <div class="yahrzeit-info">
          <div class="yahrzeit-name" id="yahrzeit-name-1">Давид бен Рахель</div>
          <div class="yahrzeit-date">3 Нисана 5783 (25.03.2023)</div>
        </div>
        <div class="yahrzeit-action">
          <button class="tool-button" data-yahrzeit="yahrzeit-name-1">Молитвы</button>
        </div>
      </div>
      
      <div class="yahrzeit-item">
        <div class="yahrzeit-info">
          <div class="yahrzeit-name" id="yahrzeit-name-2">Сара бат Лея</div>
          <div class="yahrzeit-date">15 Ияра 5782 (16.05.2022)</div>
        </div>
        <div class="yahrzeit-action">
          <button class="tool-button" data-yahrzeit="yahrzeit-name-2">Молитвы</button>
        </div>
      </div>
      
      <div class="yahrzeit-item">
        <button class="button-primary" style="padding: 8px;">Добавить годовщину</button>
      </div>
    </div>
  </div>
  
  <!-- ניווט תחתון -->
  <nav class="bottom-nav" aria-label="ניווט תחתון">
    <a href="index.html" class="bottom-nav-item" tabindex="0" aria-label="Главная">
      <div class="bottom-nav-icon">🏠</div>
      <div class="bottom-nav-label">Главная</div>
    </a>
    <a href="tehilim.html" class="bottom-nav-item" tabindex="0" aria-label="Техилим">
      <div class="bottom-nav-icon">📖</div>
      <div class="bottom-nav-label">Техилим</div>
    </a>
    <a href="#" class="bottom-nav-item active" tabindex="0" aria-label="За усопших">
      <div class="bottom-nav-icon">🕯️</div>
      <div class="bottom-nav-label">За усопших</div>
    </a>
    <a href="siddur.html" class="bottom-nav-item" tabindex="0" aria-label="Молитвенник">
      <div class="bottom-nav-icon">📝</div>
      <div class="bottom-nav-label">Молитвенник</div>
    </a>
  </nav>
  
  <script>
    // --- מערכת לוקליזציה אחידה ---
    function setLanguage(lang) {
      document.body.setAttribute('data-lang', lang);
      localStorage.setItem('lang', lang);
      document.querySelectorAll('[data-translate]').forEach(el => {
        const key = el.getAttribute('data-translate');
        if (translations[lang] && translations[lang][key]) {
          if (el.tagName === 'INPUT') el.placeholder = translations[lang][key];
          else el.textContent = translations[lang][key];
        }
      });
      updateFontSizeText();
    }
    // --- טיפול בכפתורים ונגישות ---
    function addButtonListeners() {
      // tool-button
      document.querySelectorAll('.tool-button').forEach(btn => {
        btn.setAttribute('tabindex', '0');
        btn.setAttribute('aria-label', btn.textContent.trim());
        btn.addEventListener('keydown', e => {
          if (e.key === 'Enter' || e.key === ' ') btn.click();
        });
      });
      // memorial-tool
      document.querySelectorAll('.memorial-tool').forEach(btn => {
        btn.setAttribute('tabindex', '0');
        btn.setAttribute('aria-label', btn.querySelector('.memorial-tool-title').textContent.trim());
        btn.addEventListener('click', () => {
          const title = btn.querySelector('.memorial-tool-title').textContent;
          if (title.includes('לוח שנה')) window.showCalendar();
          if (title.includes('תהילים')) window.showPsalms();
          if (title.includes('תזכורות')) window.showNotifications();
        });
        btn.addEventListener('keydown', e => {
          if (e.key === 'Enter' || e.key === ' ') btn.click();
        });
      });
      // share/print
      document.querySelectorAll('.button-print').forEach(btn => {
        btn.addEventListener('click', () => window.print());
      });
      document.querySelectorAll('.button-share').forEach(btn => {
        btn.addEventListener('click', function() {
          const prayerTitle = this.closest('.prayer-content').querySelector('.prayer-title').textContent;
          if (navigator.share) {
            navigator.share({
              title: 'Тикун Ха-Шем - ' + prayerTitle,
              text: 'Молитва: ' + prayerTitle,
              url: window.location.href
            }).catch(err => {
              showUserMessage('שגיאה בשיתוף', 'error');
            });
          } else {
            prompt('Скопируйте ссылку:', window.location.href);
          }
        });
      });
    }
    // --- פונקציות גלובליות ---
    window.showCalendar = showCalendar;
    window.showPsalms = showPsalms;
    window.showNotifications = showNotifications;
    window.saveNotificationSettings = saveNotificationSettings;
    window.closeNotification = closeNotification;
    window.loadPrayer = loadPrayer;
    // --- אתחול בטעינת הדף ---
    document.addEventListener('DOMContentLoaded', () => {
      setLanguage(localStorage.getItem('lang') || 'he');
      addButtonListeners();
      // שאר אתחולים קיימים...
    });

    // פונקציית לוקליזציה מרכזית
    const translations = {
        'he': {
            'main_title': 'תיקון השם',
            'psalms': 'תהילים',
            'prayers': 'תפילות',
            'memorial': 'אזכרה',
            'text_size': 'גודל טקסט',
            'small': 'קטן',
            'medium': 'בינוני',
            'large': 'גדול',
            'very_large': 'גדול מאוד',
            'back': 'חזרה',
            'share': 'שיתוף',
            'print': 'הדפסה',
            'bookmark': 'הוספה למועדפים',
            'input_error': 'אנא הזן ערך תקין',
            // הוסף עוד תרגומים לפי הצורך
        },
        'ru': {
            'main_title': 'Тикун Ха-Шем',
            'psalms': 'Псалмы',
            'prayers': 'Молитвы',
            'memorial': 'Поминальная служба',
            'text_size': 'Размер текста',
            'small': 'маленький',
            'medium': 'средний',
            'large': 'большой',
            'very_large': 'очень большой',
            'back': 'Назад',
            'share': 'Поделиться',
            'print': 'Печать',
            'bookmark': 'В закладки',
            'input_error': 'Пожалуйста, введите корректное значение',
            // הוסף עוד תרגומים לפי הצורך
        },
        'phonetic': {
            'main_title': 'Tikun Ha-Shem',
            'psalms': 'Tehilim',
            'prayers': 'Tfilot',
            'memorial': 'Azkara',
            'text_size': 'Godel text',
            'small': 'katan',
            'medium': 'beynoni',
            'large': 'gadol',
            'very_large': 'gadol me\'od',
            'back': 'Hazara',
            'share': 'Shituf',
            'print': 'Hadfasa',
            'bookmark': 'Hosafa le-mu\'adafim',
            'input_error': 'Na le-hazin erech takin',
            // הוסף עוד תרגומים לפי הצורך
        }
    };
    
    // פונקציה לעדכון שפת הממשק
    function updateUILanguage(lang) {
        // עדכון שפת המסמך
        document.documentElement.lang = lang;
        document.documentElement.dir = lang === 'he' ? 'rtl' : 'ltr';
        
        // החלת מחלקת שפה על גוף המסמך
        document.body.setAttribute('data-lang', lang);
        
        // עדכון כל האלמנטים המתורגמים
        document.querySelectorAll('[data-translate]').forEach(element => {
            const key = element.getAttribute('data-translate');
            if (translations[lang] && translations[lang][key]) {
                // בדיקה אם מדובר באלמנט קלט
                if (element.tagName === 'INPUT' && element.type === 'text') {
                    element.placeholder = translations[lang][key];
                } else {
                    element.textContent = translations[lang][key];
                }
            }
        });
        
        // עדכון שגיאות ותוויות של טפסים
        document.querySelectorAll('label, .error-message').forEach(element => {
            const key = element.getAttribute('data-translate');
            if (key && translations[lang] && translations[lang][key]) {
                element.textContent = translations[lang][key];
            }
        });
        
        // עדכון כפתורים
        document.querySelectorAll('button, .button').forEach(element => {
            const key = element.getAttribute('data-translate');
            if (key && translations[lang] && translations[lang][key]) {
                element.textContent = translations[lang][key];
            }
        });
        
        // עדכון גודל הטקסט בהתאם לשפה
        updateFontSizeText();
        
        // שמירת השפה שנבחרה
        localStorage.setItem('preferredLanguage', lang);
    }
    
    // הוספת תגיות data-translate לכל האלמנטים המתורגמים
    function addTranslationAttributes() {
        // דוגמאות לאלמנטים שצריך להוסיף להם
        const headerTitle = document.querySelector('.header-title');
        if (headerTitle) headerTitle.setAttribute('data-translate', 'main_title');
        document.querySelectorAll('.bottom-nav-item').forEach(item => {
            const label = item.querySelector('.bottom-nav-label');
            if (label) {
                const text = label.textContent.trim().toLowerCase();
                if (text === 'תהילים' || text === 'псалмы' || text === 'tehilim') {
                    label.setAttribute('data-translate', 'psalms');
                } else if (text === 'תפילות' || text === 'молитвы' || text === 'tfilot') {
                    label.setAttribute('data-translate', 'prayers');
                } 
                // הוסף עוד תנאים לפי הצורך
            }
        });
        
        // הוסף לכפתורים
        document.querySelectorAll('.button-print').forEach(btn => {
            btn.setAttribute('data-translate', 'print');
        });
        document.querySelectorAll('.button-share').forEach(btn => {
            btn.setAttribute('data-translate', 'share');
        });
        document.querySelectorAll('.button-bookmark').forEach(btn => {
            btn.setAttribute('data-translate', 'bookmark');
        });
        
        // הוסף לפי הצורך
    }
    
    // פונקציה לעדכון גודל טקסט
    function updateFontSizeText() {
        const fontSizeValue = document.querySelector('.font-size-value');
        if (!fontSizeValue) return;
        
        const langOption = document.querySelector('.language-option.active');
        const currentLang = langOption ? langOption.dataset.lang : 'he';
        let sizeText = '';
        
        // קביעת המלל לפי גודל הטקסט הנוכחי ושפה
        if (typeof currentFontSize !== 'undefined') {
            if (currentFontSize <= 18) {
                sizeText = translations[currentLang]['small'];
            } else if (currentFontSize <= 22) {
                sizeText = translations[currentLang]['medium'];
            } else if (currentFontSize <= 26) {
                sizeText = translations[currentLang]['large'];
            } else {
                sizeText = translations[currentLang]['very_large'];
            }
            fontSizeValue.textContent = `${translations[currentLang]['text_size']}: ${sizeText}`;
        }
    }
    
    // אתחול הממשק בטעינת הדף
    // יש להוסיף זאת אחרי כל שאר מאזיני ה-DOMLoaded כדי לא לדרוס לוגיקה קיימת
    addEventListener('DOMContentLoaded', function() {
        addTranslationAttributes();
        const savedLang = localStorage.getItem('preferredLanguage') || 'he';
        document.querySelectorAll('.language-option').forEach(option => {
            option.classList.remove('active');
            if (option.dataset.lang === savedLang) {
                option.classList.add('active');
            }
            option.addEventListener('click', function() {
                const lang = this.dataset.lang;
                document.querySelectorAll('.language-option').forEach(opt => {
                    opt.classList.remove('active');
                });
                this.classList.add('active');
                updateUILanguage(lang);
            });
        });
        updateUILanguage(savedLang);
    });
    
    document.addEventListener('DOMContentLoaded', function() {
      // החלפת שפה
      const languageOptions = document.querySelectorAll('.language-option');
      languageOptions.forEach(option => {
        option.addEventListener('click', function() {
          const lang = this.dataset.lang;
          
          // שינוי האפשרות הפעילה
          languageOptions.forEach(opt => opt.classList.remove('active'));
          this.classList.add('active');
          
          // שמירת השפה הנבחרת
          localStorage.setItem('preferredLanguage', lang);
          
          // עדכון השפה בממשק
          updateUILanguage(lang);
        });
      });
      
      // עדכון השפה בממשק
      function updateUILanguage(lang) {
        // בממשק אמיתי כאן היה קוד שמעדכן את תצוגת השפה
        console.log('Язык изменен на:', lang);
      }
      
      // טעינת השפה המועדפת בעת טעינת הדף
      const savedLang = localStorage.getItem('preferredLanguage') || 'ru';
      languageOptions.forEach(opt => {
        if (opt.dataset.lang === savedLang) {
          opt.click();
        }
      });
      
      // מעבר בין לשוניות תפילה
      const prayerTabs = document.querySelectorAll('.prayer-tab');
      prayerTabs.forEach(tab => {
        tab.addEventListener('click', function() {
          const tabId = this.dataset.tab;
          
          // מעבר ללשונית הנבחרת
          prayerTabs.forEach(t => t.classList.remove('active'));
          this.classList.add('active');
          
          // הצגת התפילה המתאימה
          document.querySelectorAll('.prayer-content').forEach(content => {
            content.style.display = 'none';
          });
          document.getElementById('prayer-' + tabId).style.display = 'block';
        });
      });
      
      // פונקציה פשוטה לסינון תווים לא רצויים
      function sanitizeInput(input) {
          return input.replace(/[<>&"']/g, function(c) {
              return {
                  '<': '&lt;',
                  '>': '&gt;',
                  '&': '&amp;',
                  '"': '&quot;',
                  "'": '&#39;'
              }[c];
          });
      }
      
      // עדכון אירוע לחיצה על כפתור update-prayers
      // מוחק את המאזין הישן ומוסיף חדש עם סניטיזציה
      const updatePrayersBtn = document.getElementById('update-prayers');
      if (updatePrayersBtn) {
          updatePrayersBtn.addEventListener('click', function() {
              // קבלת קלט וסינון
              const deceasedName = sanitizeInput(document.getElementById('deceased-name').value.trim());
              const motherName = sanitizeInput(document.getElementById('mother-name').value.trim());
              
              if (!deceasedName) {
                  alert('אנא הזן שם נפטר');
                  return;
              }
              
              // עדכון הערכים בשדות הקלט לאחר סינון
              document.getElementById('deceased-name').value = deceasedName;
              document.getElementById('mother-name').value = motherName;
              
              // המשך עדכון טקסט התפילה
              updatePrayerText(deceasedName, motherName);
          });
      }
      
      // פונקציה לעדכון טקסט התפילה עם שם הנפטר
      function updatePrayerText(name, motherName) {
        const fullName = motherName ? `${name} בן/בת ${motherName}` : name;
        
        // במימוש אמיתי כאן היה קוד שמעדכן את כל הטקסטים עם השם
        console.log('Имя усопшего обновлено:', fullName);
        
        // הצגת הודעה למשתמש
        alert('Молитвы обновлены с именем: ' + fullName);
      }
      
      // שינוי גודל טקסט
      let currentFontSize = 18; // גודל טקסט התחלתי
      const fontSizeValue = document.querySelector('.font-size-value');
      
      document.getElementById('increase-font').addEventListener('click', function() {
        if (currentFontSize < 32) {
          currentFontSize += 2;
          updateFontSize();
        }
      });
      
      document.getElementById('decrease-font').addEventListener('click', function() {
        if (currentFontSize > 16) {
          currentFontSize -= 2;
          updateFontSize();
        }
      });
      
      function updateFontSize() {
        document.querySelectorAll('.prayer-text').forEach(el => {
          el.style.fontSize = currentFontSize + 'px';
        });
        
        const currentLang = document.querySelector('.language-option.active').dataset.lang;
        let sizeText = '';
        
        if (currentFontSize <= 18) {
          sizeText = currentLang === 'ru' ? 'маленький' : 
                     currentLang === 'he' ? 'קטן' : 'katan';
        } else if (currentFontSize <= 22) {
          sizeText = currentLang === 'ru' ? 'средний' : 
                     currentLang === 'he' ? 'בינוני' : 'beynoni';
        } else if (currentFontSize <= 26) {
          sizeText = currentLang === 'ru' ? 'большой' : 
                     currentLang === 'he' ? 'גדול' : 'gadol';
        } else {
          sizeText = currentLang === 'ru' ? 'очень большой' : 
                     currentLang === 'he' ? 'גדול מאוד' : 'gadol me\'od';
        }
        
        if (currentLang === 'ru') {
          fontSizeValue.textContent = `Размер текста: ${sizeText}`;
        } else if (currentLang === 'he') {
          fontSizeValue.textContent = `גודל טקסט: ${sizeText}`;
        } else {
          fontSizeValue.textContent = `Godel text: ${sizeText}`;
        }
      }
      
      // כפתורי שיתוף
      document.querySelectorAll('.button-print').forEach(button => {
        button.addEventListener('click', function() {
          window.print();
        });
      });
      
      document.querySelectorAll('.button-share').forEach(button => {
        button.addEventListener('click', function() {
          const prayerTitle = this.closest('.prayer-content').querySelector('.prayer-title').textContent;
          
          if (navigator.share) {
            navigator.share({
              title: 'Тикун Ха-Шем - ' + prayerTitle,
              text: 'Молитва: ' + prayerTitle,
              url: window.location.href
            }).catch(err => {
              console.error('Ошибка при попытке поделиться:', err);
            });
          } else {
            // פתרון חלופי אם Web Share API לא נתמך
            prompt('Скопируйте ссылку:', window.location.href);
          }
        });
      });
      
      // טיפול ברשימת יארצייט
      function loadPrayer(nameId) {
        const name = document.getElementById(nameId).textContent;
        document.getElementById('deceased-name').value = name.split(' בן ')[0] || name;
        
        const motherMatch = name.match(/בן\s+(\S+)/);
        if (motherMatch && motherMatch[1]) {
          document.getElementById('mother-name').value = motherMatch[1];
        }
        
        document.getElementById('update-prayers').click();
        // מעבר ללשונית של אל מלא רחמים
        document.querySelector('[data-tab="el-male-rachamim"]').click();
        
        // גלילה לתפילה
        document.getElementById('prayer-el-male-rachamim').scrollIntoView({ behavior: 'smooth' });
      }
      
      // הגדרת הפונקציה כגלובלית כדי שתהיה נגישה מה-onclick
      window.loadPrayer = loadPrayer;
      
      // Enhanced calendar functionality
      let currentDate = new Date();
      let currentMonth = currentDate.getMonth();
      let currentYear = currentDate.getFullYear();
      
      function showCalendar() {
        document.querySelector('.calendar').style.display = 'block';
        document.querySelector('.psalm-selection').style.display = 'none';
        renderCalendar();
      }
      
      function renderCalendar() {
        const grid = document.getElementById('calendar-grid');
        grid.innerHTML = '';
        
        // Update month and year selectors
        document.getElementById('month-selector').value = currentMonth;
        document.getElementById('year-selector').value = currentYear;
        
        // Add day names
        const days = ['א', 'ב', 'ג', 'ד', 'ה', 'ו', 'ש'];
        days.forEach(day => {
          const dayElement = document.createElement('div');
          dayElement.className = 'calendar-day-name';
          dayElement.textContent = day;
          grid.appendChild(dayElement);
        });
        
        // Get first day of month
        const firstDay = new Date(currentYear, currentMonth, 1);
        const startingDay = firstDay.getDay();
        
        // Get days in month
        const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
        
        // Add empty cells for days before first day
        for (let i = 0; i < startingDay; i++) {
          const emptyCell = document.createElement('div');
          grid.appendChild(emptyCell);
        }
        
        // Add days
        for (let day = 1; day <= daysInMonth; day++) {
          const date = new Date(currentYear, currentMonth, day);
          const dayElement = document.createElement('div');
          dayElement.className = 'calendar-day';
          
          // Add classes based on date
          if (day === currentDate.getDate() && currentMonth === currentDate.getMonth() && currentYear === currentDate.getFullYear()) {
            dayElement.classList.add('today');
          }
          
          if (isYahrzeit(date)) {
            dayElement.classList.add('yahrzeit');
          }
          
          // Add Hebrew date
          const hebrewDate = getHebrewDate(date);
          
          dayElement.innerHTML = `
            <div class="calendar-day-number">${day}</div>
            <div class="calendar-day-name">${hebrewDate}</div>
            ${isYahrzeit(date) ? '<div class="calendar-day-yahrzeit">יום זיכרון</div>' : ''}
          `;
          
          dayElement.addEventListener('click', () => handleDayClick(date));
          grid.appendChild(dayElement);
        }
        
        // Update yahrzeit list
        updateYahrzeitList();
      }
      
      function changeMonth(month) {
        currentMonth = parseInt(month);
        renderCalendar();
      }
      
      function changeYear(year) {
        currentYear = parseInt(year);
        renderCalendar();
      }
      
      function updateYahrzeitList() {
        const list = document.getElementById('yahrzeit-list');
        list.innerHTML = '';
        
        const yahrzeits = JSON.parse(localStorage.getItem('yahrzeits') || '[]');
        const currentMonthYahrzeits = yahrzeits.filter(y => {
          const yDate = new Date(y.date);
          return yDate.getMonth() === currentMonth && yDate.getFullYear() === currentYear;
        });
        
        if (currentMonthYahrzeits.length === 0) {
          list.innerHTML = '<div class="yahrzeit-list-empty">אין ימי זיכרון בחודש זה</div>';
          return;
        }
        
        currentMonthYahrzeits.forEach(y => {
          const item = document.createElement('div');
          item.className = 'yahrzeit-list-item';
          const date = new Date(y.date);
          item.innerHTML = `
            <div class="yahrzeit-list-date">${date.getDate()} ${getMonthName(date.getMonth())}</div>
            <div class="yahrzeit-list-name">${y.name}</div>
            <button class="yahrzeit-list-remove" onclick="removeYahrzeit('${y.id}')">×</button>
          `;
          list.appendChild(item);
        });
      }
      
      function getMonthName(month) {
        const months = [
          'ינואר', 'פברואר', 'מרץ', 'אפריל', 'מאי', 'יוני',
          'יולי', 'אוגוסט', 'ספטמבר', 'אוקטובר', 'נובמבר', 'דצמבר'
        ];
        return months[month];
      }
      
      function removeYahrzeit(id) {
        const yahrzeits = JSON.parse(localStorage.getItem('yahrzeits') || '[]');
        const updatedYahrzeits = yahrzeits.filter(y => y.id !== id);
        localStorage.setItem('yahrzeits', JSON.stringify(updatedYahrzeits));
        updateYahrzeitList();
        renderCalendar();
        showToast('יום הזיכרון נמחק בהצלחה', 'success');
      }
      
      // Psalm selection functionality
      function showPsalms() {
        document.querySelector('.calendar').style.display = 'none';
        document.querySelector('.psalm-selection').style.display = 'block';
        renderPsalmGrid();
      }
      
      // Enhanced psalm selection
      const psalms = [
        { number: 16, title: 'מזמור ט"ז', categories: ['memorial', 'protection'] },
        { number: 23, title: 'מזמור כ"ג', categories: ['memorial', 'protection'] },
        { number: 30, title: 'מזמור ל', categories: ['thanks', 'healing'] },
        { number: 33, title: 'מזמור ל"ג', categories: ['thanks', 'protection'] },
        { number: 34, title: 'מזמור ל"ד', categories: ['protection', 'memorial'] },
        { number: 90, title: 'מזמור צ', categories: ['memorial', 'protection'] },
        { number: 91, title: 'מזמור צ"א', categories: ['protection', 'healing'] },
        { number: 103, title: 'מזמור ק"ג', categories: ['memorial', 'thanks'] },
        { number: 104, title: 'מזמור ק"ד', categories: ['thanks', 'protection'] },
        { number: 121, title: 'מזמור קכ"א', categories: ['protection', 'memorial'] },
        { number: 130, title: 'מזמור ק"ל', categories: ['memorial', 'healing'] },
        { number: 150, title: 'מזמור ק"נ', categories: ['thanks'] }
      ];
      
      let currentCategory = 'all';
      let currentSearch = '';
      
      function renderPsalmGrid() {
        const grid = document.getElementById('psalm-grid');
        grid.innerHTML = '';
        
        const filteredPsalms = psalms.filter(psalm => {
          const matchesCategory = currentCategory === 'all' || psalm.categories.includes(currentCategory);
          const matchesSearch = currentSearch === '' || 
            psalm.title.includes(currentSearch) || 
            psalm.number.toString().includes(currentSearch);
          return matchesCategory && matchesSearch;
        });
        
        filteredPsalms.forEach(psalm => {
          const item = document.createElement('div');
          item.className = 'psalm-selection-item';
          item.innerHTML = `
            <div class="psalm-number">${psalm.number}</div>
            <div class="psalm-title">${psalm.title}</div>
            <div class="psalm-categories">${psalm.categories.map(cat => 
              `<span class="psalm-category-tag">${getCategoryName(cat)}</span>`
            ).join('')}</div>
          `;
          item.addEventListener('click', () => selectPsalm(psalm.number));
          grid.appendChild(item);
        });
      }
      
      function getCategoryName(category) {
        const names = {
          'memorial': 'לזכר נפטר',
          'healing': 'לרפואה',
          'protection': 'לשמירה',
          'thanks': 'להודיה'
        };
        return names[category] || category;
      }
      
      function filterPsalms(search) {
        currentSearch = search;
        renderPsalmGrid();
      }
      
      // Add category click handlers
      document.querySelectorAll('.psalm-category').forEach(button => {
        button.addEventListener('click', () => {
          document.querySelector('.psalm-category.active').classList.remove('active');
          button.classList.add('active');
          currentCategory = button.dataset.category;
          renderPsalmGrid();
        });
      });
      
      // Enhanced notification system
      function showNotifications() {
        const notification = document.createElement('div');
        notification.className = 'memorial-notification';
        notification.innerHTML = `
          <div class="memorial-notification-icon">🔔</div>
          <div class="memorial-notification-content">
            <div class="memorial-notification-title">הגדרות התראות</div>
            <div class="memorial-notification-options">
              <div class="notification-option">
                <label>
                  <input type="checkbox" id="notify-day-before" checked>
                  התראה יום לפני
                </label>
              </div>
              <div class="notification-option">
                <label>
                  <input type="checkbox" id="notify-week-before">
                  התראה שבוע לפני
                </label>
              </div>
              <div class="notification-option">
                <label>
                  <input type="checkbox" id="notify-month-before">
                  התראה חודש לפני
                </label>
              </div>
              <div class="notification-option">
                <label>
                  <input type="checkbox" id="notify-same-day">
                  התראה ביום עצמו
                </label>
              </div>
            </div>
            <div class="notification-time">
              <label>שעת ההתראה:</label>
              <input type="time" id="notification-time" value="09:00">
            </div>
            <div class="notification-actions">
              <button class="notification-save" onclick="saveNotificationSettings()">שמור</button>
              <button class="notification-cancel" onclick="closeNotification()">ביטול</button>
            </div>
          </div>
        `;
        
        // Load saved settings
        const settings = JSON.parse(localStorage.getItem('notificationSettings') || '{}');
        document.getElementById('notify-day-before').checked = settings.dayBefore !== false;
        document.getElementById('notify-week-before').checked = settings.weekBefore || false;
        document.getElementById('notify-month-before').checked = settings.monthBefore || false;
        document.getElementById('notify-same-day').checked = settings.sameDay !== false;
        document.getElementById('notification-time').value = settings.time || '09:00';
        
        document.body.appendChild(notification);
        setTimeout(() => notification.classList.add('show'), 100);
      }
      
      function saveNotificationSettings() {
        const settings = {
          dayBefore: document.getElementById('notify-day-before').checked,
          weekBefore: document.getElementById('notify-week-before').checked,
          monthBefore: document.getElementById('notify-month-before').checked,
          sameDay: document.getElementById('notify-same-day').checked,
          time: document.getElementById('notification-time').value
        };
        
        localStorage.setItem('notificationSettings', JSON.stringify(settings));
        closeNotification();
        showToast('הגדרות ההתראות נשמרו בהצלחה', 'success');
        
        // Schedule notifications
        scheduleNotifications();
      }
      
      function closeNotification() {
        const notification = document.querySelector('.memorial-notification');
        if (notification) {
          notification.classList.remove('show');
          setTimeout(() => notification.remove(), 300);
        }
      }
      
      function scheduleNotifications() {
        // Clear existing notifications
        if ('Notification' in window) {
          Notification.requestPermission().then(permission => {
            if (permission === 'granted') {
              const yahrzeits = JSON.parse(localStorage.getItem('yahrzeits') || '[]');
              const settings = JSON.parse(localStorage.getItem('notificationSettings') || '{}');
              
              yahrzeits.forEach(yahrzeit => {
                const date = new Date(yahrzeit.date);
                
                // Schedule notifications based on settings
                if (settings.dayBefore) {
                  scheduleNotification(date, -1, yahrzeit.name, settings.time);
                }
                if (settings.weekBefore) {
                  scheduleNotification(date, -7, yahrzeit.name, settings.time);
                }
                if (settings.monthBefore) {
                  scheduleNotification(date, -30, yahrzeit.name, settings.time);
                }
                if (settings.sameDay) {
                  scheduleNotification(date, 0, yahrzeit.name, settings.time);
                }
              });
            }
          });
        }
      }
      
      function scheduleNotification(date, daysOffset, name, time) {
        const notificationDate = new Date(date);
        notificationDate.setDate(notificationDate.getDate() + daysOffset);
        
        const [hours, minutes] = time.split(':');
        notificationDate.setHours(parseInt(hours), parseInt(minutes), 0, 0);
        
        const now = new Date();
        if (notificationDate > now) {
          const timeout = notificationDate - now;
          setTimeout(() => {
            new Notification('תזכורת ליום זיכרון', {
              body: `יום הזיכרון של ${name} ${daysOffset === 0 ? 'היום' : `בעוד ${Math.abs(daysOffset)} ימים`}`,
              icon: '/icons/icon-192x192.png'
            });
          }, timeout);
        }
      }
      
      // Initialize notifications on page load
      document.addEventListener('DOMContentLoaded', () => {
        if ('Notification' in window) {
          Notification.requestPermission();
        }
        scheduleNotifications();
      });
    });

    // פונקציית הצגת הודעות למשתמש
    function showUserMessage(message, type = 'info', duration = 5000) {
        // בדיקה אם כבר קיים מיכל הודעות
        let messageContainer = document.querySelector('.user-messages');
        if (!messageContainer) {
            // יצירת מיכל הודעות
            messageContainer = document.createElement('div');
            messageContainer.className = 'user-messages';
            document.body.appendChild(messageContainer);
            // הוספת סגנון למיכל ההודעות
            const style = document.createElement('style');
            style.textContent = `
                .user-messages {
                    position: fixed;
                    top: 10px;
                    left: 50%;
                    transform: translateX(-50%);
                    z-index: 1000;
                    width: 80%;
                    max-width: 400px;
                }
                .user-message {
                    padding: 12px 16px;
                    margin-bottom: 10px;
                    border-radius: 8px;
                    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
                    animation: message-fade-in 0.3s ease;
                    transition: opacity 0.3s, transform 0.3s;
                }
                .user-message.info {
                    background-color: #e3f2fd;
                    border-left: 4px solid #2196F3;
                    color: #0d47a1;
                }
                .user-message.error {
                    background-color: #ffebee;
                    border-left: 4px solid #f44336;
                    color: #b71c1c;
                }
                .user-message.success {
                    background-color: #e8f5e9;
                    border-left: 4px solid #4CAF50;
                    color: #1b5e20;
                }
                .user-message.warning {
                    background-color: #fff8e1;
                    border-left: 4px solid #FFC107;
                    color: #ff6f00;
                }
                @keyframes message-fade-in {
                    from { opacity: 0; transform: translateY(-20px); }
                    to { opacity: 1; transform: translateY(0); }
                }
            `;
            document.head.appendChild(style);
        }
        // יצירת אלמנט ההודעה
        const messageElement = document.createElement('div');
        messageElement.className = `user-message ${type}`;
        messageElement.textContent = message;
        // הוספת ההודעה למיכל
        messageContainer.appendChild(messageElement);
        // הסרת ההודעה לאחר פרק זמן מוגדר
        setTimeout(() => {
            messageElement.style.opacity = '0';
            messageElement.style.transform = 'translateY(-20px)';
            setTimeout(() => {
                messageContainer.removeChild(messageElement);
            }, 300);
        }, duration);
        return messageElement;
    }

    // טיפול בשגיאות כלליות
    window.addEventListener('error', function(event) {
        console.error('JavaScript error:', event.message);
        showUserMessage('אירעה שגיאה בטעינת הדף. אנא רענן את הדף או נסה שוב מאוחר יותר.', 'error');
    });

    // טיפול בשגיאות fetch
    async function fetchWithErrorHandling(url, options = {}) {
        try {
            const response = await fetch(url, options);
            if (!response.ok) {
                throw new Error(`HTTP error ${response.status}`);
            }
            return await response.json();
        } catch (error) {
            console.error('Fetch error:', error);
            showUserMessage('אירעה שגיאה בטעינת נתונים. אנא נסה שוב מאוחר יותר.', 'error');
            throw error;
        }
    }

    // טיפול בתאריכים בלוח השנה
    function safelyParseDate(dateStr) {
        try {
            const date = new Date(dateStr);
            if (isNaN(date.getTime())) {
                throw new Error('Invalid date format');
            }
            return date;
        } catch (error) {
            console.error('Error parsing date:', error);
            showUserMessage('פורמט תאריך לא תקין', 'error');
            return new Date(); // החזר תאריך נוכחי כברירת מחדל
        }
    }

    // שימוש בפונקציה במקומות רלוונטיים
    function isYahrzeit(date) {
        try {
            const yahrzeits = JSON.parse(localStorage.getItem('yahrzeits') || '[]');
            return yahrzeits.some(y => {
                const yahrzeitDate = safelyParseDate(y.date);
                return yahrzeitDate.getDate() === date.getDate() && 
                       yahrzeitDate.getMonth() === date.getMonth();
            });
        } catch (error) {
            console.error('Error checking yahrzeit:', error);
            showUserMessage('שגיאה בבדיקת תאריכי יארצייט', 'error');
            return false;
        }
    }
  </script>
  <!-- הוספת showUserMessage, sanitizeInput, ותמיכה במקלדת -->
  <script>
    document.querySelectorAll('.prayer-tab, .bottom-nav-item, .language-option, .tool-button').forEach(el => {
      el.addEventListener('keydown', function(e) {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          this.click();
        }
      });
    });
  </script>
  <script src="js/i18n.js"></script>
  <script>
    document.querySelectorAll('.language-option').forEach(opt => {
      opt.addEventListener('click', () => setLanguage(opt.dataset.lang));
    });
    setLanguage(localStorage.getItem('lang') || 'he');
  </script>
  <script>
    // ... existing code ...
    document.addEventListener('DOMContentLoaded', function() {
      // memorial-tool buttons
      const memorialTools = document.querySelectorAll('.memorial-tool');
      memorialTools[0].addEventListener('click', window.showCalendar);
      memorialTools[1].addEventListener('click', window.showPsalms);
      memorialTools[2].addEventListener('click', window.showNotifications);
      memorialTools.forEach(btn => {
        btn.setAttribute('tabindex', '0');
        btn.setAttribute('aria-label', btn.querySelector('.memorial-tool-title').textContent.trim());
        btn.addEventListener('keydown', e => {
          if (e.key === 'Enter' || e.key === ' ') btn.click();
        });
      });
      // calendar-nav buttons
      const navButtons = document.querySelectorAll('.calendar-nav-button');
      navButtons[0].addEventListener('click', window.prevMonth);
      navButtons[1].addEventListener('click', window.nextMonth);
      navButtons.forEach(btn => {
        btn.setAttribute('tabindex', '0');
        btn.setAttribute('aria-label', btn.textContent.trim());
        btn.addEventListener('keydown', e => {
          if (e.key === 'Enter' || e.key === ' ') btn.click();
        });
      });
      // month/year selectors
      document.getElementById('month-selector').addEventListener('change', e => window.changeMonth(e.target.value));
      document.getElementById('year-selector').addEventListener('change', e => window.changeYear(e.target.value));
      // psalm search
      document.querySelector('.search-input').addEventListener('input', e => window.filterPsalms(e.target.value));
      // yahrzeit buttons
      document.querySelectorAll('[data-yahrzeit]').forEach(btn => {
        btn.addEventListener('click', () => window.loadPrayer(btn.getAttribute('data-yahrzeit')));
        btn.setAttribute('tabindex', '0');
        btn.setAttribute('aria-label', btn.textContent.trim());
        btn.addEventListener('keydown', e => {
          if (e.key === 'Enter' || e.key === ' ') btn.click();
        });
      });
      // psalm-category
      document.querySelectorAll('.psalm-category').forEach(button => {
        button.addEventListener('click', () => {
          document.querySelector('.psalm-category.active').classList.remove('active');
          button.classList.add('active');
          window.currentCategory = button.dataset.category;
          window.renderPsalmGrid();
        });
        button.setAttribute('tabindex', '0');
        button.setAttribute('aria-label', button.textContent.trim());
        button.addEventListener('keydown', e => {
          if (e.key === 'Enter' || e.key === ' ') button.click();
        });
      });
    });
    // --- הפיכת כל הפונקציות ל-globals ---
    window.prevMonth = prevMonth;
    window.nextMonth = nextMonth;
    window.changeMonth = changeMonth;
    window.changeYear = changeYear;
    window.filterPsalms = filterPsalms;
    window.loadPrayer = loadPrayer;
    window.renderPsalmGrid = renderPsalmGrid;
    // שימוש ב-showUserMessage במקום alert/showToast בכל מקום
    // ... existing code ...
  </script>
  <script>
    // תרגום אוטומטי
    document.querySelectorAll('.language-option').forEach(opt => {
      opt.addEventListener('click', () => {
        localStorage.setItem('lang', opt.dataset.lang);
        if (typeof setLanguage === 'function') setLanguage(opt.dataset.lang);
      });
    });
    // שחזור שפה בטעינת הדף
    const savedLang = localStorage.getItem('lang') || 'he';
    if (typeof setLanguage === 'function') setLanguage(savedLang);

    // הדגשת שמות קדושים (אם תרצה)
    function highlightDivineNamesInPage() {
      if (typeof correctText !== 'function') return;
      document.querySelectorAll('.prayer-text, .prayer-title, .prayer-section-title').forEach(el => {
        if (!el.dataset.originalText) el.dataset.originalText = el.textContent;
        const result = correctText(el.dataset.originalText, 'hebrew');
        el.innerHTML = result.html;
      });
    }
    function removeHighlightDivineNamesInPage() {
      document.querySelectorAll('.prayer-text, .prayer-title, .prayer-section-title').forEach(el => {
        if (el.dataset.originalText) el.textContent = el.dataset.originalText;
      });
    }
    function toggleNameHighlightMode() {
      document.body.classList.toggle('highlight-names');
      const btn = document.getElementById('toggle-name-highlight');
      if (btn) {
        const isActive = document.body.classList.contains('highlight-names');
        btn.setAttribute('aria-pressed', isActive);
        btn.classList.toggle('active', isActive);
        showUserMessage(isActive ? 'הדגשת שמות הופעלה' : 'הדגשה בוטלה', 'info');
      }
      if (document.body.classList.contains('highlight-names')) {
        highlightDivineNamesInPage();
      } else {
        removeHighlightDivineNamesInPage();
      }
    }
    const toggleNameHighlight = document.getElementById('toggle-name-highlight');
    if (toggleNameHighlight) {
      toggleNameHighlight.addEventListener('click', toggleNameHighlightMode);
    }
  </script>
</body>
</html>